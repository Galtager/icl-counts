{"version":3,"file":"CreateCount.controller.js","names":["BaseController","CreateCount","onInit","oRouter","UIComponent","getRouterFor","getRoute","attachMatched","_initialFunc","onAfterRendering","searchFieldExpand","oEvent","countModel","getCountsModel","initModelState","fetchItems","fetchLoactions","setProperty","myComponent","i18n","fetch","then","res","json","data","key","searchFieldId","searchField","getView","byId","attachBrowserEvent","iturSearchState","getProperty","returnFromLocateSeacrh","acceptLocate","from","to","itemsList","oBinding","getBinding","aFilter","Filter","FilterOperator","BT","filter","selectLocation","selItem","getSource","getBindingContext","getObject","focusedInput","focus","checkSelected","getParameter","items","atLeastOne","find","item","selected","checkDelete","deleteState","addToList","selectedItems","removeFromList","deleteItems","onCreateCount","id","onStartCount","createdCount","navToCount"],"sources":["../../src/controller/CreateCount.controller.ts"],"sourcesContent":["import BaseController from \"./BaseController\";\r\nimport Event from \"sap/ui/base/Event\";\r\nimport UIComponent from \"sap/ui/core/UIComponent\";\r\nimport SearchField from \"sap/m/SearchField\";\r\nimport StandardListItem from \"sap/m/StandardListItem\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport { IItemForCount } from \"./SingleCount.controller\";\r\nimport List from \"sap/m/List\";\r\nimport ListBinding from \"sap/ui/model/ListBinding\";\r\nimport Filter from \"sap/ui/model/Filter\";\r\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\r\nimport models from \"../model/models\";\r\n\r\ntype ISearchFieldKey = 'fromSF' | 'toSF'\r\ntype ILocation = { key: string };\r\ntype ICreatedCount = { id: string }\r\n/**\r\n * @namespace ICL.InventoryCount.controller\r\n */\r\nexport default class CreateCount extends BaseController {\r\n    onInit() {\r\n        super.onInit();\r\n        const oRouter = UIComponent.getRouterFor(this);\r\n        // eslint-disable-next-line @typescript-eslint/unbound-method\r\n        oRouter.getRoute(\"createCount\").attachMatched(this._initialFunc, this);\r\n    }\r\n    onAfterRendering() {\r\n        this.searchFieldExpand('fromSF')\r\n        this.searchFieldExpand('toSF')\r\n    }\r\n\r\n    private _initialFunc(oEvent: Event) {\r\n        const countModel = this.getCountsModel();\r\n        this.initModelState(countModel)\r\n\r\n        this.fetchItems(countModel)\r\n        this.fetchLoactions(countModel)\r\n        countModel.setProperty('/oMaintain/title', myComponent.i18n('createCount'));\r\n        countModel.setProperty('/oFlags/headerNavBack', true);\r\n\r\n    }\r\n\r\n    private initModelState(countModel: JSONModel) {\r\n        countModel.setProperty('/oMaintain/createCount/tabKey', '1');\r\n        countModel.setProperty('/oMaintain/createCount/currStep', '1')\r\n        countModel.setProperty('/oFlags/iturSearch', false);\r\n        countModel.setProperty('/oMaintain/createCount/newItems', []);\r\n    }\r\n    private fetchItems(countModel: JSONModel) {\r\n        void fetch(\"/mockData/itemsInCounts.JSON\")\r\n            .then(res => res.json())\r\n            .then((data: IItemForCount[]) => {\r\n                countModel.setProperty('/oData/itemsToAdd', data)\r\n            })\r\n    }\r\n    private fetchLoactions(countModel: JSONModel) {\r\n        countModel.setProperty('/oData/locations', [\r\n            { key: \"I01/I01\" },\r\n            { key: \"I01/I02\" },\r\n            { key: \"I01/I03\" },\r\n            { key: \"I01/I04\" },\r\n            { key: \"I01/I05\" },\r\n            { key: \"I01/I06\" },\r\n            { key: \"I01/I07\" },\r\n            { key: \"I01/I08\" },\r\n        ]\r\n        );\r\n    }\r\n    protected searchFieldExpand(searchFieldId: ISearchFieldKey) {\r\n        const countModel = this.getCountsModel();\r\n        const searchField = this.getView().byId(searchFieldId) as SearchField;\r\n        searchField.attachBrowserEvent('focusin', () => {\r\n            // save old values\r\n            const iturSearchState = countModel.getProperty('/oFlags/iturSearch') as boolean\r\n            if (!iturSearchState) {\r\n                countModel.setProperty('/oMaintain/createCount/oldToSF', countModel.getProperty('/oMaintain/createCount/toSF') || \"\");\r\n                countModel.setProperty('/oMaintain/createCount/oldFromSF', countModel.getProperty('/oMaintain/createCount/fromSF') || \"\");\r\n            }\r\n            countModel.setProperty('/oFlags/iturSearchFocus', searchFieldId);\r\n            countModel.setProperty('/oFlags/iturSearch', true);\r\n        })\r\n\r\n    }\r\n    returnFromLocateSeacrh() {\r\n        const countModel = this.getCountsModel();\r\n        countModel.setProperty('/oFlags/iturSearch', false);\r\n        countModel.setProperty('/oMaintain/createCount/toSF', countModel.getProperty('/oMaintain/createCount/oldToSF'));\r\n        countModel.setProperty('/oMaintain/createCount/fromSF', countModel.getProperty('/oMaintain/createCount/oldFromSF'));\r\n\r\n    }\r\n    acceptLocate(oEvent: Event) {\r\n        const countModel = this.getCountsModel();\r\n        countModel.setProperty('/oFlags/iturSearch', false);\r\n        const from = countModel.getProperty('/oMaintain/createCount/fromSF') as string;\r\n        const to = countModel.getProperty('/oMaintain/createCount/toSF') as string;\r\n        const itemsList = this.getView().byId('itemsToAdd') as List,\r\n            oBinding = itemsList.getBinding(\"items\") as ListBinding,\r\n            aFilter = [\r\n                new Filter('storageLoc', FilterOperator.BT, from, to),\r\n            ];\r\n        if (!!from && !!to)\r\n            oBinding.filter(aFilter);\r\n        else\r\n            oBinding.filter(null)\r\n    }\r\n    selectLocation(oEvent: Event) {\r\n        const countModel = this.getCountsModel();\r\n        const selItem = (oEvent.getSource() as StandardListItem).getBindingContext('CountsModel').getObject() as ILocation;\r\n        const focusedInput = countModel.getProperty('/oFlags/iturSearchFocus') as ISearchFieldKey;\r\n        countModel.setProperty(`/oMaintain/createCount/${focusedInput}`, selItem.key);\r\n        if (focusedInput === 'fromSF')\r\n            (this.getView().byId('toSF') as SearchField).focus()\r\n    }\r\n    checkSelected(oEvent: Event) {\r\n        const countModel = this.getCountsModel();\r\n\r\n        if (!oEvent.getParameter('selected')) {\r\n            // check there is some selected\r\n            const items = countModel.getProperty('/oData/itemsToAdd') as IItemForCount[];\r\n            const atLeastOne = items.find(item => item.selected);\r\n            countModel.setProperty('/oFlags/itemsToAddSelected', !!atLeastOne)\r\n        }\r\n        else {\r\n            countModel.setProperty('/oFlags/itemsToAddSelected', true)\r\n        }\r\n    }\r\n    checkDelete(oEvent: Event) {\r\n        const countModel = this.getCountsModel();\r\n        if (!oEvent.getParameter('selected')) {\r\n            // check there is some selected\r\n            const items = countModel.getProperty('/oMaintain/createCount/newItems') as IItemForCount[];\r\n            const atLeastOne = items.find(item => item.deleteState);\r\n            countModel.setProperty('/oFlags/itemsToDelete', !!atLeastOne)\r\n        }\r\n        else {\r\n            countModel.setProperty('/oFlags/itemsToDelete', true)\r\n        }\r\n    }\r\n    addToList() {\r\n        const countModel = this.getCountsModel();\r\n        const items = countModel.getProperty('/oData/itemsToAdd') as IItemForCount[];\r\n        const selectedItems = items.filter(item => item.selected);\r\n        countModel.setProperty('/oMaintain/createCount/newItems', selectedItems);\r\n        countModel.setProperty('/oMaintain/createCount/tabKey', '2');\r\n    }\r\n    removeFromList() {\r\n        const countModel = this.getCountsModel();\r\n        const items = countModel.getProperty('/oMaintain/createCount/newItems') as IItemForCount[];\r\n        const deleteItems = items.filter(item => !item.deleteState);\r\n        countModel.setProperty('/oMaintain/createCount/newItems', deleteItems)\r\n    }\r\n    onCreateCount() {\r\n        const countModel = this.getCountsModel();\r\n        countModel.setProperty('/oMaintain/createCount/currStep', '2');\r\n        // post request to get the new created count\r\n        countModel.setProperty('/oData/createdCount', { id: '1234567890' })\r\n\r\n    }\r\n    onStartCount(oEvent: Event) {\r\n        const countModel = this.getCountsModel();\r\n        const createdCount = countModel.getProperty('/oData/createdCount') as ICreatedCount\r\n        this.navToCount(oEvent, createdCount.id)\r\n    }\r\n\r\n}"],"mappings":"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"}