{"version":3,"file":"SingleCount.controller.js","names":["BaseController","SingleCount","onInit","oRouter","UIComponent","getRouterFor","getRoute","attachMatched","_initialFunc","onAfterRendering","searchFieldExpand","oEvent","countModel","getCountsModel","setProperty","myComponent","i18n","arguments","getParameter","items","getProperty","loadCount","selCount","fetchCount","fetchItems","fetch","then","res","json","data","fetchedCount","filter","order","countId","id","find","toggleLongDesc","pathToToggle","getSource","getBindingContext","getPath","toggleInfo","onChangeAmount","pathToUpdate","newValue","openItemDetails","itemSelected","getObject","itemDetails","fetchItemDetails","itemNum","onFragmentHandler","selectedId","item","openAttchment","alert","openFooterScan","onQRScanner","onEndCountDialog","countedItems","approve","onEndCountProccess","navTo","approveItem","selItemPath","choosePersonalNumber"],"sources":["../../src/controller/SingleCount.controller.ts"],"sourcesContent":["import UIComponent from \"sap/ui/core/UIComponent\";\r\nimport BaseController from \"./BaseController\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport { ICount } from \"./Main.controller\";\r\nimport UI5Event from \"sap/ui/base/Event\";\r\nimport Button from \"sap/m/Button\";\r\nimport SearchField from \"sap/m/SearchField\";\r\nimport Link from \"sap/m/Link\";\r\n\r\ntype IArguments = {\r\n    id: string\r\n}\r\nexport type IItemForCount = {\r\n    selected?: boolean\r\n    personalNums?: string[]\r\n    approve?: boolean\r\n    deleteState?: boolean\r\n    countId: string\r\n    amount: string\r\n    itemNum: string\r\n    status: string\r\n    statusDesc: string\r\n    storageLoc: string\r\n    count?: string\r\n    type: string\r\n    desc: string\r\n    supplier: string\r\n    longDesc: string\r\n    accessType: string\r\n    isMichlol: boolean\r\n    unit: string\r\n\r\n}\r\ntype IItemDetails = {\r\n    itemNum: string\r\n    desc: string\r\n    unit: string\r\n    personalNum: string\r\n    storageType: string\r\n    storageLoc: string\r\n    attachment: IAttachment\r\n}\r\ntype IAttachment = {\r\n    name: string\r\n    fileType: string\r\n    base64: string\r\n}\r\n/**\r\n * @namespace ICL.InventoryCount.controller\r\n */\r\nexport default class SingleCount extends BaseController {\r\n    private arguments: IArguments\r\n    onInit() {\r\n        super.onInit();\r\n        const oRouter = UIComponent.getRouterFor(this);\r\n        // eslint-disable-next-line @typescript-eslint/unbound-method\r\n        oRouter.getRoute(\"singleCount\").attachMatched(this._initialFunc, this);\r\n    }\r\n    onAfterRendering() {\r\n        this.searchFieldExpand('countSF')\r\n    }\r\n    private _initialFunc(oEvent: UI5Event) {\r\n        const countModel = this.getCountsModel();\r\n        countModel.setProperty('/oMaintain/title', myComponent.i18n('countTitle'));\r\n        this.arguments = oEvent.getParameter(\"arguments\") as IArguments;\r\n        const items = countModel.getProperty('/oData/countItems') as IItemForCount[]\r\n        if (!items)\r\n            this.loadCount(countModel)\r\n\r\n    }\r\n    private loadCount(countModel: JSONModel) {\r\n\r\n        const selCount = countModel.getProperty('/oMaintain/selCount') as ICount;\r\n        if (!selCount) {\r\n            this.fetchCount(countModel)\r\n        }\r\n        this.fetchItems(countModel)\r\n    }\r\n    private fetchItems(countModel: JSONModel) {\r\n        void fetch(\"/mockData/itemsInCounts.JSON\")\r\n            .then(res => res.json())\r\n            .then((data: IItemForCount[]) => {\r\n                const fetchedCount = data.filter(order => order.countId === this.arguments.id)\r\n                countModel.setProperty('/oData/countItems', fetchedCount)\r\n            })\r\n    }\r\n    private fetchCount(countModel: JSONModel) {\r\n        void fetch(\"/mockData/CountsList.JSON\")\r\n            .then(res => res.json())\r\n            .then((data: ICount[]) => {\r\n                const fetchedCount = data.find(order => order.id === this.arguments.id)\r\n                countModel.setProperty('/oMaintain/selCount', fetchedCount)\r\n            })\r\n    }\r\n    toggleLongDesc(oEvent: UI5Event) {\r\n        const pathToToggle = (oEvent.getSource() as Button).getBindingContext('CountsModel').getPath()\r\n        this.toggleInfo(oEvent, `${pathToToggle}/collapse`)\r\n    }\r\n    onChangeAmount(oEvent: UI5Event) {\r\n        const pathToUpdate = (oEvent.getSource() as SearchField).getBindingContext('CountsModel').getPath()\r\n        const countModel = this.getCountsModel();\r\n        const newValue = (oEvent.getParameter('newValue') as string);\r\n        countModel.setProperty(`${pathToUpdate}/count`, newValue)\r\n    }\r\n    async openItemDetails(oEvent: UI5Event) {\r\n        const itemSelected = (oEvent.getSource() as Link).getBindingContext('CountsModel').getObject() as IItemForCount\r\n        const countModel = this.getCountsModel();\r\n        const itemDetails = await this.fetchItemDetails(itemSelected.itemNum);\r\n        countModel.setProperty('/oData/itemDetails', itemDetails);\r\n        void this.onFragmentHandler(oEvent, 'Dialog_itemDetails', true);\r\n\r\n    }\r\n    fetchItemDetails(selectedId: string) {\r\n        return fetch(\"/mockData/itemDetails.JSON\")\r\n            .then(res => res.json())\r\n            .then((data: IItemDetails[]) => {\r\n                return data.find(item => item.itemNum === selectedId)\r\n            })\r\n\r\n    }\r\n    private openAttchment(oEvent: UI5Event) {\r\n        alert('open attachment')\r\n    }\r\n    private openFooterScan(oEvent: UI5Event) {\r\n        this.onQRScanner(oEvent)\r\n    }\r\n    onEndCountDialog(oEvent: UI5Event) {\r\n        const countModel = this.getCountsModel();\r\n        const items = countModel.getProperty('/oData/countItems') as IItemForCount[]\r\n        const countedItems = items.filter(item => item.approve);\r\n\r\n        countModel.setProperty('/oMaintain/countedItems', countedItems)\r\n        void this.onFragmentHandler(oEvent, 'Dialog_endCount', true)\r\n\r\n    }\r\n    onEndCountProccess() {\r\n        // make post requiest and update sap\r\n        // then\r\n        this.navTo('endCount')\r\n    }\r\n    approveItem(oEvent: UI5Event) {\r\n        const countModel = this.getCountsModel();\r\n        const selItemPath = (oEvent.getSource() as Button).getBindingContext('CountsModel').getPath();\r\n        countModel.setProperty(`${selItemPath}/approve`, true)\r\n    }\r\n    choosePersonalNumber(oEvent: UI5Event) {\r\n        const selItemPath = (oEvent.getSource() as Button).getBindingContext('CountsModel').getPath();\r\n        const countModel = this.getCountsModel();\r\n        countModel.setProperty('/oMaintain/selItemForPN', selItemPath)\r\n        this.navTo('personalNumbers');\r\n    }\r\n}"],"mappings":"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"}