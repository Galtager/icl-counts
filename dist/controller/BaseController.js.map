{"version":3,"file":"BaseController.js","names":["formatter","models","BaseController","Controller","firstRun","fragments","onInit","countModel","getCountsModel","loadFilters","loadIcons","getRouter","myComponent","getOwnerComponent","getResourceBundle","oModel","getModel","sName","getView","setModel","navTo","oParameters","bReplace","undefined","onNavBack","window","history","go","getMainView","viewController","cancelFragment","oEvent","fragmentName","id","getId","close","onFragmentHandler","isDialog","isOpen","oButton","getSource","fragment","Fragment","load","name","controller","addDependent","open","openBy","deleteRowFromList","aList","deleteRow","i","length","splice","refresh","aFonts","fontFamily","fontURI","sap","ui","require","toUrl","forEach","oFont","IconPool","registerFont","CountsModel","fetch","then","res","json","data","setProperty","toggleInfo","modelPath","getProperty","navToCount","searchFieldExpand","searchFieldId","searchField","byId","attachBrowserEvent","onQRScanner","successCallBacl","console","log","failCB","e","BarcodeScanner","scan","i18n","resetModel","createJsonModel","oTempModel","setData","myNavBack","oRouter","UIComponent","getRouterFor","getRouteInfoByHash","getHashChanger","getHash","goBackHome"],"sources":["../../src/controller/BaseController.ts"],"sourcesContent":["import AppComponent from \"../Component\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\n\r\nimport Controller from \"sap/ui/core/mvc/Controller\";\r\nimport UIComponent from \"sap/ui/core/UIComponent\";\r\nimport Model from \"sap/ui/model/Model\";\r\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\r\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\r\nimport Router from \"sap/ui/core/routing/Router\";\r\nimport History from \"sap/ui/core/routing/History\";\r\nimport formatter from \"../model/formatter\";\r\nimport UI5Event from \"sap/ui/base/Event\";\r\nimport Fragment from \"sap/ui/core/Fragment\";\r\nimport UI5Element from \"sap/ui/core/Element\";\r\nimport View from \"sap/ui/core/mvc/View\";\r\nimport Popover from \"sap/m/Popover\";\r\nimport Dialog from \"sap/m/Dialog\";\r\nimport IconPool from \"sap/ui/core/IconPool\";\r\nimport SearchField from \"sap/m/SearchField\";\r\nimport BarcodeScanner from \"sap/ndc/BarcodeScanner\";\r\nimport models from \"../model/models\";\r\n\r\n/**\r\n * @namespace ICL.InventoryCount.controller\r\n */\r\nexport default abstract class BaseController extends Controller {\r\n\tprotected viewController: Controller;\r\n\tprivate firstRun = true;\r\n\r\n\tpublic formatter = formatter;\r\n\tpublic fragments: {\r\n\t\t[key: string]: Popover | Dialog;\r\n\t} = {};\r\n\tonInit() {\r\n\t\t// run only \r\n\t\tif (this.firstRun) {\r\n\t\t\tthis.firstRun = false;\r\n\r\n\t\t\tconst countModel = this.getCountsModel();\r\n\t\t\tthis.loadFilters(countModel);\r\n\t\t\tthis.loadIcons();\r\n\t\t}\r\n\t}\r\n\tprivate getRouter(): Router {\r\n\t\treturn (myComponent as UIComponent).getRouter();\r\n\t}\r\n\tpublic getOwnerComponent(): AppComponent {\r\n\t\treturn (super.getOwnerComponent() as AppComponent);\r\n\t}\r\n\tpublic getResourceBundle(): ResourceBundle | Promise<ResourceBundle> {\r\n\t\tconst oModel = this.getOwnerComponent().getModel(\"i18n\") as ResourceModel;\r\n\t\treturn oModel.getResourceBundle();\r\n\t}\r\n\tpublic getModel(sName?: string): Model {\r\n\t\treturn this.getView().getModel(sName);\r\n\t}\r\n\tpublic setModel(oModel: Model, sName?: string): BaseController {\r\n\t\tthis.getView().setModel(oModel, sName);\r\n\t\treturn this;\r\n\t}\r\n\tpublic navTo(sName: string, oParameters?: object, bReplace?: boolean): void {\r\n\t\tthis.getRouter().navTo(sName, oParameters, undefined, bReplace);\r\n\t}\r\n\tpublic onNavBack(): void {\r\n\t\twindow.history.go(-1);\r\n\t}\r\n\tprivate getMainView(): View {\r\n\t\treturn this.getView() || this.viewController.getView();\r\n\t}\r\n\r\n\tpublic cancelFragment(oEvent: UI5Event, fragmentName: string) {\r\n\t\tconst id = this.getMainView().getId() + '--' + fragmentName;\r\n\t\tthis.fragments[id].close();\r\n\t}\r\n\tpublic async onFragmentHandler(oEvent: UI5Event, fragmentName: string, isDialog?: boolean): Promise<void> {\r\n\t\tconst id = this.getMainView().getId() + '--' + fragmentName;\r\n\t\tif (!!this.fragments[id] && !isDialog && this.fragments[id].isOpen()) {\r\n\t\t\tthis.cancelFragment(oEvent, fragmentName);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst oButton = oEvent?.getSource() as UI5Element;\r\n\t\t\tif (!this.fragments[id]) {\r\n\t\t\t\tconst fragment = await Fragment.load({ name: \"ICL.InventoryCount.view.fragments.\" + fragmentName, controller: this });\r\n\t\t\t\tthis.fragments[id] = fragment as Dialog\r\n\t\t\t\tthis.getView().addDependent(this.fragments[id] as UI5Element);\r\n\t\t\t}\r\n\t\t\tisDialog ? (this.fragments[id] as Dialog).open() : (this.fragments[id] as Popover).openBy(oButton, true);\r\n\t\t}\r\n\t}\r\n\tpublic deleteRowFromList<T>(aList: T[], deleteRow: T) { //generic function for all lists\r\n\t\tfor (let i = 0; i < aList.length; i++) {\r\n\t\t\tif (aList[i] == deleteRow) {\r\n\t\t\t\taList.splice(i, 1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmyComponent.getModel(\"LocalModel\").refresh();\r\n\t}\r\n\tprivate loadIcons() {\r\n\t\tconst aFonts = [\r\n\t\t\t{\r\n\t\t\t\tfontFamily: \"SAP-icons-TNT\",\r\n\t\t\t\tfontURI: sap.ui.require.toUrl(\"sap/tnt/themes/base/fonts/\")\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tfontFamily: \"BusinessSuiteInAppSymbols\",\r\n\t\t\t\tfontURI: sap.ui.require.toUrl(\"sap/ushell/themes/base/fonts/\")\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\taFonts.forEach(oFont => {\r\n\t\t\tIconPool.registerFont(oFont);\r\n\t\t});\r\n\r\n\t}\r\n\tpublic getCountsModel() {\r\n\t\tconst CountsModel = myComponent.getModel(\"CountsModel\") as JSONModel;\r\n\t\treturn CountsModel;\r\n\t}\r\n\tprivate loadFilters(countModel: JSONModel) {\r\n\t\tvoid fetch(\"/mockData/CountsFilter.JSON\")\r\n\t\t\t.then(res => res.json())\r\n\t\t\t.then(data => countModel.setProperty('/oData/CountsFilter', data))\r\n\t}\r\n\tpublic toggleInfo(oEvent: UI5Event | null, modelPath: string) {\r\n\t\tconst countModel = this.getCountsModel();\r\n\t\tcountModel.setProperty(modelPath, !countModel.getProperty(modelPath));\r\n\t}\r\n\tpublic navToCount(oEvent: UI5Event, id: string) {\r\n\t\tmyComponent.getRouter().navTo(\"singleCount\", { id });\r\n\t}\r\n\tprotected searchFieldExpand(searchFieldId: string) {\r\n\t\tconst searchField = this.getView().byId(searchFieldId) as SearchField;\r\n\t\tsearchField.attachBrowserEvent('focusin', () => {\r\n\t\t\tthis.toggleInfo(null, `/oFlags/${searchFieldId}Toggle`)\r\n\t\t})\r\n\t\tsearchField.attachBrowserEvent('focusout', () => {\r\n\t\t\tthis.toggleInfo(null, `/oFlags/${searchFieldId}Toggle`)\r\n\t\t})\r\n\r\n\t}\r\n\tprotected onQRScanner(oEvent: UI5Event) {\r\n\t\tconst successCallBacl = (data: any) => {\r\n\t\t\tconsole.log(data)\r\n\t\t}\r\n\t\tconst failCB = (e: any) => {\r\n\t\t\tconsole.log(e)\r\n\t\t}\r\n\t\tBarcodeScanner.scan(successCallBacl, failCB, null, myComponent.i18n('barcodescanner'));\r\n\t}\r\n\tprotected resetModel() {\r\n\t\tthis.setModel(models.createJsonModel(), \"TempModel\");\r\n\t\tconst oTempModel = this.getModel(\"TempModel\") as JSONModel;\r\n\t\tconst countModel = this.getCountsModel();\r\n\t\tcountModel.setData(oTempModel);\r\n\t}\r\n\tprotected myNavBack(oEvent: UI5Event) {\r\n\t\tconst oRouter = UIComponent.getRouterFor(this);\r\n\t\tif (oRouter.getRouteInfoByHash(oRouter.getHashChanger().getHash()).name === 'singleCount') {\r\n\t\t\tvoid this.onFragmentHandler(oEvent, 'Dialog_NavBack', true)\r\n\t\t}\r\n\t\telse { this.onNavBack() }\r\n\t}\r\n\tprivate goBackHome() {\r\n\t\t// this.resetModel();\r\n\t\tthis.navTo('main');\r\n\t}\r\n\r\n}\r\n"],"mappings":"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"}